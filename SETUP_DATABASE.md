# ğŸš€ å¿«é€Ÿè¨­ç½® Supabase æ•¸æ“šåº«ï¼ˆç”¨æ–¼ Cloudflare Workersï¼‰

## ğŸ“‹ èªªæ˜

æœ¬é …ç›®ä½¿ç”¨ **Supabase**ï¼ˆPostgreSQL + pgvectorï¼‰ä½œç‚ºæ•¸æ“šåº«ï¼Œå®Œç¾é©é… Cloudflare Workers éƒ¨ç½²ã€‚

## âš¡ å¿«é€Ÿè¨­ç½®ï¼ˆ5 åˆ†é˜ï¼‰

### æ­¥é©Ÿ 1ï¼šå‰µå»º Supabase é …ç›®

1. **è¨ªå• Supabase**
   - æ‰“é–‹ç€è¦½å™¨è¨ªå•ï¼šhttps://supabase.com
   - é»æ“Šå³ä¸Šè§’ **"Start your project"** æˆ– **"Sign Up"**

2. **è¨»å†Š/ç™»éŒ„**
   - ä½¿ç”¨ **GitHub** ç™»éŒ„ï¼ˆæ¨è–¦ï¼Œæœ€ç°¡å–®ï¼‰
   - æˆ–ä½¿ç”¨ Email è¨»å†Š

3. **å‰µå»ºçµ„ç¹”**ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
   - è¼¸å…¥çµ„ç¹”åç¨±ï¼ˆå¦‚ `my-org`ï¼‰
   - é»æ“Š **"Create organization"**

4. **å‰µå»ºé …ç›®**
   - é»æ“Š **"New Project"**
   - å¡«å¯«é …ç›®ä¿¡æ¯ï¼š
     - **Name**: `mastra-rag`ï¼ˆæˆ–æ‚¨å–œæ­¡çš„åç¨±ï¼‰
     - **Database Password**: âš ï¸ **è¨­ç½®å¼·å¯†ç¢¼ä¸¦è¨˜ä½å®ƒï¼**
       - å»ºè­°ï¼šè‡³å°‘ 12 å€‹å­—ç¬¦ï¼ŒåŒ…å«å¤§å°å¯«å­—æ¯ã€æ•¸å­—å’Œç‰¹æ®Šå­—ç¬¦
     - **Region**: é¸æ“‡é›¢æ‚¨æœ€è¿‘çš„å€åŸŸ
       - æ¨è–¦ï¼š`Southeast Asia (Singapore)`ï¼ˆäºæ´²ç”¨æˆ¶ï¼‰
   - é»æ“Š **"Create new project"**
   - ç­‰å¾… 2-3 åˆ†é˜å‰µå»ºå®Œæˆ

### æ­¥é©Ÿ 2ï¼šç²å–é€£æ¥å­—ç¬¦ä¸²

1. **é€²å…¥è¨­ç½®é é¢**
   - åœ¨ Supabase Dashboard ä¸­
   - é»æ“Šå·¦å´ **"Settings"**ï¼ˆé½’è¼ªåœ–æ¨™ âš™ï¸ï¼‰
   - é»æ“Š **"Database"**

2. **è¤‡è£½é€£æ¥å­—ç¬¦ä¸²**
   - æ»¾å‹•åˆ° **"Connection string"** éƒ¨åˆ†
   - é¸æ“‡ **"URI"** æ¨™ç±¤
   - é»æ“Šå³å´çš„ **è¤‡è£½åœ–æ¨™** ğŸ“‹
   - å°‡ `[YOUR-PASSWORD]` æ›¿æ›ç‚ºæ‚¨è¨­ç½®çš„æ•¸æ“šåº«å¯†ç¢¼

   **æ ¼å¼ç¤ºä¾‹**ï¼š
   ```
   postgresql://postgres:your-password@db.xxxxx.supabase.co:5432/postgres
   ```

### æ­¥é©Ÿ 3ï¼šé‹è¡Œè¨­ç½®è…³æœ¬

åœ¨é …ç›®ç›®éŒ„ä¸­é‹è¡Œï¼š

```bash
cd /Users/gjf/Desktop/project/jcyd-34/new-mastra
node scripts/setup-supabase.js
```

**æŒ‰æç¤ºè¼¸å…¥**ï¼š
1. **Supabase é …ç›® URL**ï¼šä¾‹å¦‚ `https://xxxxx.supabase.co`
2. **æ•¸æ“šåº«å¯†ç¢¼**ï¼šæ‚¨å‰µå»ºé …ç›®æ™‚è¨­ç½®çš„å¯†ç¢¼
3. **æ•¸æ“šåº«ç«¯å£**ï¼šç›´æ¥å›è»Šï¼ˆé»˜èª 5432ï¼‰

è…³æœ¬æœƒè‡ªå‹•ï¼š
- âœ… å‰µå»º/æ›´æ–° `.env` æ–‡ä»¶
- âœ… è¨­ç½® PostgreSQL é€£æ¥å­—ç¬¦ä¸²
- âœ… å¯é¸ï¼šè¨­ç½® Cloudflare Workers ç’°å¢ƒè®Šé‡

### æ­¥é©Ÿ 4ï¼šå•Ÿç”¨ pgvector æ“´å±•

1. **æ‰“é–‹ SQL Editor**
   - åœ¨ Supabase Dashboard ä¸­
   - é»æ“Šå·¦å´ **"SQL Editor"**
   - é»æ“Š **"New query"**

2. **åŸ·è¡Œ SQL å‘½ä»¤**
   ```sql
   CREATE EXTENSION IF NOT EXISTS vector;
   ```

3. **é‹è¡ŒæŸ¥è©¢**
   - é»æ“Š **"Run"** æŒ‰éˆ•ï¼ˆæˆ–æŒ‰ `Cmd/Ctrl + Enter`ï¼‰
   - æ‡‰è©²çœ‹åˆ°ï¼š**"Success. No rows returned"**

âœ… pgvector æ“´å±•å·²æˆåŠŸå•Ÿç”¨ï¼

### æ­¥é©Ÿ 5ï¼šæ¸¬è©¦é€£æ¥

é‹è¡Œæ‡‰ç”¨æ¸¬è©¦æ•¸æ“šåº«é€£æ¥ï¼š

```bash
pnpm server
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼Œèªªæ˜é€£æ¥æˆåŠŸï¼š
```
âœ… pgvector database table is ready
ğŸš€ Server running on http://localhost:3000
```

## âœ… é©—è­‰è¨­ç½®

### æª¢æŸ¥æ•¸æ“šåº«è¡¨

åœ¨ Supabase Dashboard ä¸­ï¼š

1. é»æ“Šå·¦å´ **"Table Editor"**
2. é‹è¡Œæ‡‰ç”¨å¾Œï¼Œæ‡‰è©²èƒ½çœ‹åˆ° `docs` è¡¨
3. è¡¨çµæ§‹æ‡‰è©²åŒ…å«ï¼š
   - `id` (TEXT)
   - `text` (TEXT)
   - `vector` (vector(1536))
   - `metadata` (JSONB)
   - `created_at` (TIMESTAMP)

## ğŸ”§ è¨­ç½® Cloudflare Workers ç’°å¢ƒè®Šé‡ï¼ˆå¯é¸ï¼‰

å¦‚æœè¦åœ¨ Cloudflare Workers ä¸­ä½¿ç”¨ï¼Œè¨­ç½®ç’°å¢ƒè®Šé‡ï¼š

```bash
# è¨­ç½® PostgreSQL é€£æ¥å­—ç¬¦ä¸²
npx wrangler secret put POSTGRES_URL
# ç„¶å¾Œç²˜è²¼é€£æ¥å­—ç¬¦ä¸²

# è¨­ç½® OpenAI API Key
npx wrangler secret put OPENAI_API_KEY
# ç„¶å¾Œç²˜è²¼ API Key
```

## ğŸ‰ å®Œæˆï¼

æ‚¨çš„ Supabase æ•¸æ“šåº«å·²ç¶“è¨­ç½®å®Œæˆï¼

## ğŸ“ ä¸‹ä¸€æ­¥

1. **è¨­ç½® OpenAI API Key**ï¼ˆå¦‚æœé‚„æ²’è¨­ç½®ï¼‰
   - åœ¨ `.env` æ–‡ä»¶ä¸­è¨­ç½® `OPENAI_API_KEY`
   - æˆ–é‹è¡Œï¼š`npx wrangler secret put OPENAI_API_KEY`

2. **æ¸¬è©¦æ‡‰ç”¨**
   ```bash
   pnpm server
   ```
   è¨ªå• http://localhost:3000

3. **éƒ¨ç½²åˆ° Cloudflare Workers**
   ```bash
   pnpm run deploy:worker
   ```

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q: é€£æ¥å¤±æ•—æ€éº¼è¾¦ï¼Ÿ

**A:** æª¢æŸ¥ä»¥ä¸‹å¹¾é»ï¼š
1. é€£æ¥å­—ç¬¦ä¸²ä¸­çš„å¯†ç¢¼æ˜¯å¦æ­£ç¢º
2. Supabase é …ç›®æ˜¯å¦å·²å‰µå»ºå®Œæˆ
3. ç¶²çµ¡é€£æ¥æ˜¯å¦æ­£å¸¸
4. æ˜¯å¦å•Ÿç”¨äº† pgvector æ“´å±•

### Q: å¦‚ä½•é‡ç½®æ•¸æ“šåº«å¯†ç¢¼ï¼Ÿ

**A:** 
1. é€²å…¥ Settings â†’ Database
2. é»æ“Š "Reset database password"
3. è¨­ç½®æ–°å¯†ç¢¼
4. æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„é€£æ¥å­—ç¬¦ä¸²

### Q: å…è²»å±¤ç´šçš„é™åˆ¶æ˜¯ä»€éº¼ï¼Ÿ

**A:**
- æ•¸æ“šåº«å¤§å°ï¼š500MB
- API è«‹æ±‚ï¼š50,000 æ¬¡/æœˆ
- å­˜å„²ï¼š1GB
- å¸¶å¯¬ï¼š2GB/æœˆ

å°æ–¼ä¸­å°å‹é …ç›®ï¼Œå…è²»å±¤ç´šå®Œå…¨è¶³å¤ ï¼

## ğŸ’¡ æç¤º

1. **å‚™ä»½å¯†ç¢¼**ï¼šå°‡æ•¸æ“šåº«å¯†ç¢¼ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹
2. **å®šæœŸå‚™ä»½**ï¼šSupabase æœƒè‡ªå‹•å‚™ä»½ï¼Œä½†å»ºè­°å®šæœŸå°å‡ºæ•¸æ“š
3. **ç›£æ§ä½¿ç”¨é‡**ï¼šå®šæœŸæª¢æŸ¥ä½¿ç”¨æƒ…æ³ï¼Œé¿å…è¶…å‡ºå…è²»å±¤ç´š
4. **å®‰å…¨**ï¼šä¸è¦åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼å¯†ç¢¼ï¼Œä½¿ç”¨ç’°å¢ƒè®Šé‡

## ğŸ“š ç›¸é—œè³‡æº

- [Supabase å®˜æ–¹æ–‡æª”](https://supabase.com/docs)
- [pgvector æ–‡æª”](https://github.com/pgvector/pgvector)
- [QUICK_SETUP.md](./QUICK_SETUP.md) - å¿«é€Ÿè¨­ç½®æŒ‡å—
- [SUPABASE_SETUP_GUIDE.md](./SUPABASE_SETUP_GUIDE.md) - è©³ç´°è¨­ç½®æŒ‡å—


